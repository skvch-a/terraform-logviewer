# Sample gRPC Plugins

–≠—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä—ã –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–æ–≤.

## –ü–ª–∞–≥–∏–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –±–∞–∑–µ gRPC

–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ Terraform.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü–ª–∞–≥–∏–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ gRPC-—Å–µ—Ä–≤–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ:
1. –ü–æ–ª—É—á–∞—é—Ç –ª–æ–≥–∏ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∏—Ö —Å–æ–≥–ª–∞—Å–Ω–æ —Å–≤–æ–µ–π –ª–æ–≥–∏–∫–µ
3. –í–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–∞

–ö–∞–∂–¥—ã–π –ø–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω:
- –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `LogPlugin` –∏–∑ `log_plugin.proto`
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –º–µ—Ç–æ–¥ `ProcessLogs` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–æ–≤
- –ó–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π gRPC-—Å–µ—Ä–≤–µ—Ä

### –ü—Ä–∏–º–µ—Ä: Error Aggregator Plugin

`error_aggregator_plugin.py` - –ø–ª–∞–≥–∏–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø—É –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç–∏.

**–§—É–Ω–∫—Ü–∏–∏:**
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø—É (–∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è)
- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –∫–∞–∂–¥–æ–π –æ—à–∏–±–∫–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏ (–ø–µ—Ä–≤–æ–µ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ)
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ Request ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
docker-compose up -d
```

### 2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000 –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å –ª–æ–≥–∞–º–∏.

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
cd sample-plugins
python test_plugin.py
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ó–∞–ø—É—Å—Ç–∏—Ç –ø–ª–∞–≥–∏–Ω –Ω–∞ –ø–æ—Ä—Ç—É 50051
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –µ–≥–æ –≤ backend
- –û–±—Ä–∞–±–æ—Ç–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
- –ü–æ–∫–∞–∂–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 4. –†–µ–∑—É–ª—å—Ç–∞—Ç

–í—ã —É–≤–∏–¥–∏—Ç–µ –æ—Ç—á—ë—Ç –≤–∏–¥–∞:

```
üìä RESULTS:
============================================================

Total errors: 15, Unique error types: 3, Most common: 'Connection timeout' (10 times)

Error Types (sorted by frequency):
------------------------------------------------------------

1. Connection timeout
   Count: 10, First: 2024-01-01T10:00:00, Last: 2024-01-01T10:15:00
   Sample Request IDs: req-001, req-003, req-007

2. Resource not found
   Count: 3, First: 2024-01-01T10:05:00, Last: 2024-01-01T10:10:00
   Sample Request IDs: req-002, req-005

3. Permission denied
   Count: 2, First: 2024-01-01T10:08:00, Last: 2024-01-01T10:12:00
   Sample Request IDs: req-004
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞

```bash
curl -X POST "http://localhost:8000/api/plugins/register?name=error-aggregator&address=localhost:50051"
```

### –°–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤

```bash
curl http://localhost:8000/api/plugins/list
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤

```bash
curl -X POST "http://localhost:8000/api/plugins/process?plugin_name=error-aggregator&level=error"
```

## –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞

### 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

```python
from app.plugins import log_plugin_pb2, log_plugin_pb2_grpc

class MyPlugin(log_plugin_pb2_grpc.LogPluginServicer):
    def ProcessLogs(self, request, context):
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        results = []
        for log in request.logs:
            # –û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –∫–∞–∂–¥—ã–π –ª–æ–≥
            pass
        
        return log_plugin_pb2.LogResponse(
            results=results,
            summary="–í–∞—à–µ —Ä–µ–∑—é–º–µ"
        )

def serve(port=50052):
    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))
    log_plugin_pb2_grpc.add_LogPluginServicer_to_server(MyPlugin(), server)
    server.add_insecure_port(f'[::]:{port}')
    server.start()
    server.wait_for_termination()
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–ª–∞–≥–∏–Ω

```bash
python my_plugin.py 50052
```

### 3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ —Å–∏—Å—Ç–µ–º–µ

```bash
curl -X POST "http://localhost:8000/api/plugins/register?name=my-plugin&address=localhost:50052"
```

### 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ

```bash
curl -X POST "http://localhost:8000/api/plugins/process?plugin_name=my-plugin"
```

## –ò–¥–µ–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤

- **Performance Analyzer** - –∞–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- **Dependency Tracker** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Ä–µ—Å—É—Ä—Å–∞–º–∏
- **Security Auditor** - –ø–æ–∏—Å–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Cost Estimator** - –æ—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- **Pattern Detector** - –ø–æ–∏—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ –∞–Ω–æ–º–∞–ª–∏–π

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.12+
- grpcio
- grpcio-tools

–£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
